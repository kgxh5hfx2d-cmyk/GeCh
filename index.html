<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover">
    <title>LohnCheck Pro</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root { 
            --bg: #050505; 
            --card: #121212; 
            --accent: #6366f1; 
            --text: #ffffff; 
            --text-dim: #94a3b8;
            --divider: rgba(255,255,255,0.08); 
        }
        .light-mode { 
            --bg: #f2f2f7; 
            --card: #ffffff; 
            --text: #000000; 
            --text-dim: #6b7280;
            --divider: rgba(0,0,0,0.08); 
        }
        
        body { 
            background-color: var(--bg); color: var(--text); font-family: 'Plus Jakarta Sans', sans-serif; 
            transition: background-color 0.4s ease, color 0.4s ease; padding-bottom: 40px; -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        /* iOS Blur Effect */
        .ios-blur { 
            background: rgba(10, 10, 10, 0.75); 
            backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); 
            border-bottom: 1px solid var(--divider); 
        }
        .light-mode .ios-blur { background: rgba(255, 255, 255, 0.8); }

        .nav-btn { padding: 12px 10px; border-radius: 14px; font-size: 13px; font-weight: 700; flex: 1; text-align: center; transition: 0.2s; }
        .nav-btn.active { 
            background: var(--accent); color: white; 
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }
        
        .card { 
            background: var(--card); border-radius: 22px; 
            border: 1px solid var(--divider); overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .calendar-grid { display: grid; grid-template-columns: 55px 1fr 75px; align-items: center; border-bottom: 1px solid var(--divider); padding: 12px; }
        
        .btn-shift { 
            width: 38px; height: 38px; border-radius: 11px; font-size: 12px; font-weight: 800; 
            border: 1px solid var(--divider); background: rgba(255,255,255,0.03); color: var(--text-dim); 
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .btn-shift.active { 
            background: var(--accent); border-color: transparent; color: white; 
            box-shadow: 0 0 12px rgba(99, 102, 241, 0.4);
            transform: scale(1.05);
        }
        
        input.hr-edit, select.ios-select { 
            background: rgba(99, 102, 241, 0.08) !important; border: 1px solid rgba(99, 102, 241, 0.2) !important; 
            border-radius: 10px; text-align: center; font-weight: 700; font-size: 14px; color: var(--text); 
            outline: none; height: 38px; width: 100%; transition: 0.2s;
        }

        .brand-footer { 
            text-align: center; padding: 60px 0 40px; letter-spacing: 6px; font-weight: 900; font-size: 20px; 
            color: var(--text); opacity: 0.15;
        }

        .safe-area { padding-top: env(safe-area-inset-top); }

        /* PRINT OPTIMIERUNG */
        @media print {
            nav, .brand-footer, button, select, .btn-shift, input.hr-edit { display: none !important; }
            body { background: white !important; color: black !important; padding: 0; }
            .card { border: 1px solid #ccc !important; box-shadow: none !important; margin-bottom: 20px; }
            #tab-rechner, #tab-plan { display: block !important; }
            .hidden { display: block !important; }
            .text-indigo-500, .text-indigo-400, .text-emerald-400 { color: #000 !important; font-weight: bold; }
        }
    </style>
</head>
<body class="safe-area">

    <nav class="ios-blur sticky top-0 z-50 p-4 mb-4">
        <div class="max-w-lg mx-auto flex items-center justify-between gap-3">
            <div class="flex flex-1 gap-1 bg-white/5 p-1 rounded-2xl border border-white/5">
                <button type="button" onclick="switchTab('plan')" id="btn-plan" class="nav-btn active">Plan</button>
                <button type="button" onclick="switchTab('rechner')" id="btn-rechner" class="nav-btn text-slate-500">Lohn</button>
                <button type="button" onclick="switchTab('profil')" id="btn-profil" class="nav-btn text-slate-500">Setup</button>
            </div>
            <button onclick="document.body.classList.toggle('light-mode')" class="w-12 h-12 flex items-center justify-center bg-white/5 rounded-2xl border border-white/10 active:scale-90 transition-transform">üåì</button>
        </div>
    </nav>

    <main class="px-4 max-w-lg mx-auto">
        
        <div id="tab-plan" class="space-y-4">
            <div class="flex justify-between items-end px-1">
                <div>
                    <select id="monthSelect" onchange="renderCalendar()" class="bg-transparent font-extrabold text-2xl text-indigo-500 outline-none"></select>
                    <div id="yearSelectContainer">
                         <select id="yearSelect" onchange="renderCalendar()" class="bg-transparent font-bold text-sm opacity-40 outline-none"></select>
                    </div>
                </div>
                <div class="text-right">
                    <div id="planIst" class="text-xs font-bold opacity-40">0h</div>
                    <div id="planSaldo" class="text-xs font-black px-3 py-1 rounded-lg mt-1">-</div>
                </div>
            </div>
            <div class="card" id="calendarContainer"></div>
        </div>

        <div id="tab-rechner" class="hidden space-y-6">
            <div class="text-center py-10">
                <p class="text-[11px] opacity-40 uppercase font-black tracking-[0.2em] mb-2">Gesch√§tztes Netto</p>
                <div class="flex items-start justify-center">
                    <span class="text-2xl font-bold mt-2 mr-1">‚Ç¨</span>
                    <h1 id="finalNetto" class="text-7xl font-black tracking-tighter">0,00</h1>
                </div>
            </div>
            <div class="grid grid-cols-3 gap-3">
                <div class="card p-4 text-center border-none bg-indigo-500/10">
                    <p class="text-[9px] opacity-50 uppercase font-bold mb-1">Nacht</p>
                    <p id="statN" class="font-black text-indigo-400 text-lg">0h</p>
                </div>
                <div class="card p-4 text-center border-none bg-red-500/10">
                    <p class="text-[9px] opacity-50 uppercase font-bold mb-1">Sonntag</p>
                    <p id="statSo" class="font-black text-red-400 text-lg">0h</p>
                </div>
                <div class="card p-4 text-center border-none bg-emerald-500/10">
                    <p class="text-[9px] opacity-50 uppercase font-bold mb-1">Feiertag</p>
                    <p id="statFt" class="font-black text-emerald-400 text-lg">0h</p>
                </div>
            </div>
            <div class="card">
                <div class="flex justify-between p-4 text-sm border-b border-white/5">
                    <span class="opacity-60">Brutto inkl. √ú-Std</span>
                    <span id="bruttoLabel" class="font-bold"></span>
                </div>
                <div class="flex justify-between p-4 text-sm">
                    <span class="text-emerald-400 font-bold">Steuerfreie Zuschl√§ge</span>
                    <span id="taxFreeLabel" class="text-emerald-400 font-black"></span>
                </div>
            </div>
            
            <div class="grid grid-cols-2 gap-3">
                <button onclick="shareWhatsApp()" class="bg-[#25D366] text-black font-black py-4 rounded-2xl shadow-lg active:scale-95 transition-transform flex items-center justify-center gap-2 text-sm">
                    <span>WhatsApp</span>
                </button>
                <button onclick="shareOrPrint()" class="bg-white/10 text-white font-black py-4 rounded-2xl shadow-lg border border-white/10 active:scale-95 transition-transform flex items-center justify-center gap-2 text-sm">
                    <span>Teilen / PDF</span>
                </button>
            </div>
        </div>

        <div id="tab-profil" class="hidden space-y-4">
            <div class="card">
                <div class="p-4 border-b border-white/5 flex justify-between items-center">
                    <span class="font-semibold">Grundgehalt (‚Ç¨)</span>
                    <input type="number" id="tarif" value="4275" oninput="saveAndCalc()" class="hr-edit w-28">
                </div>
                <div class="p-4 border-b border-white/5 flex justify-between items-center">
                    <span class="font-semibold">Soll-Stunden</span>
                    <input type="number" id="sollstunden" value="167" oninput="saveAndCalc()" class="hr-edit w-28">
                </div>
                <div class="p-4 flex justify-between items-center">
                    <span class="font-semibold text-indigo-400">Auszahlung √ú-Std</span>
                    <input type="number" id="h_ue" value="0" oninput="saveAndCalc()" class="hr-edit w-28">
                </div>
            </div>

            <div class="card">
                <div class="p-4 border-b border-white/5 flex justify-between items-center">
                    <span class="font-semibold">Steuerklasse</span>
                    <select id="st_klasse" onchange="saveAndCalc()" class="ios-select w-32">
                        <option value="1">Klasse 1</option><option value="2">Klasse 2</option><option value="3">Klasse 3</option>
                        <option value="4" selected>Klasse 4</option><option value="5">Klasse 5</option><option value="6">Klasse 6</option>
                    </select>
                </div>
                <div class="p-4 border-b border-white/5 flex justify-between items-center">
                    <span class="font-semibold">Kirchensteuer</span>
                    <select id="kirche" onchange="saveAndCalc()" class="ios-select w-32"><option value="0">Keine</option><option value="0.08">8%</option><option value="0.09">9%</option></select>
                </div>
                <div class="p-4 flex justify-between items-center">
                    <span class="font-semibold">Kinderfreibetrag</span>
                    <select id="kinder" onchange="saveAndCalc()" class="ios-select w-32">
                        <option value="0">0.0</option><option value="0.5">0.5</option><option value="1.0">1.0</option><option value="2.0">2.0</option>
                    </select>
                </div>
            </div>
            
            <button onclick="resetAllShifts()" class="w-full bg-red-500/10 text-red-500 font-bold py-4 rounded-2xl mt-6 border border-red-500/20 active:bg-red-500 active:text-white transition-all">
                KALENDER LEEREN
            </button>
        </div>

        <div class="brand-footer">MSNR DESIGN</div>
    </main>

    <script>
        const monthNames = ["Januar", "Februar", "M√§rz", "April", "Mai", "Juni", "Juli", "August", "September", "Oktober", "November", "Dezember"];
        const shiftH = { 'F': 7.0, 'S': 7.0, 'N': 10, 'Sp': 8.0, 'U': 7.7, 'X': 0 };
        let userPlan = JSON.parse(localStorage.getItem('springer_v5')) || {};

        function getHolidays(y) {
            const h = {}; const add = (d, m) => h[`${y}-${m}-${d}`] = true;
            add(1,0); add(1,4); add(3,9); add(31,9); add(25,11); add(26,11);
            const a=y%19, b=y%4, c=y%7, d=(19*a+24)%30, e=(2*b+4*c+6*d+5)%7;
            const ost = new Date(y, 2, 22+d+e);
            const addR = (o) => { let x=new Date(ost); x.setDate(ost.getDate()+o); h[`${y}-${x.getMonth()}-${x.getDate()}`]=true; };
            [-2, 0, 1, 39, 49, 50, 60].forEach(addR); return h;
        }

        function init() {
            const ms = document.getElementById('monthSelect'), ys = document.getElementById('yearSelect'), now = new Date();
            ms.innerHTML = ''; ys.innerHTML = '';
            monthNames.forEach((n,i) => ms.innerHTML += `<option value="${i}" ${i===now.getMonth()?'selected':''}>${n}</option>`);
            for(let i=now.getFullYear()-1; i<now.getFullYear()+5; i++) ys.innerHTML += `<option value="${i}" ${i===now.getFullYear()?'selected':''}>${i}</option>`;
            
            ['tarif', 'sollstunden', 'h_ue', 'st_klasse', 'kinder', 'kirche'].forEach(id => {
                const v = localStorage.getItem('p_'+id);
                if(v !== null) document.getElementById(id).value = v;
            });
            renderCalendar();
        }

        function switchTab(t) {
            ['plan', 'rechner', 'profil'].forEach(tab => {
                document.getElementById('tab-'+tab).classList.toggle('hidden', tab !== t);
                document.getElementById('btn-'+tab).classList.toggle('active', tab === t);
                document.getElementById('btn-'+tab).classList.toggle('text-slate-500', tab !== t);
            });
        }

        function renderCalendar() {
            const m = parseInt(document.getElementById('monthSelect').value), y = parseInt(document.getElementById('yearSelect').value);
            const container = document.getElementById('calendarContainer'), hols = getHolidays(y);
            container.innerHTML = ''; 
            let date = new Date(y, m, 1);
            
            while (date.getMonth() === m) {
                const d = date.getDate(), key = `${y}-${m}-${d}`, data = userPlan[key] || { type: 'X', hours: 0 };
                const isFt = hols[key], isSo = date.getDay()===0, isSa = date.getDay()===6;
                const row = document.createElement('div');
                row.className = `calendar-grid ${isSo||isFt?'bg-red-500/[0.03]':(isSa?'bg-indigo-500/[0.03]':'')}`;
                row.innerHTML = `
                    <div class="flex flex-col"><span class="text-[10px] font-black ${isSo||isFt?'text-red-500':(isSa?'text-indigo-400':'opacity-20')}">${date.toLocaleDateString('de-DE',{weekday:'short'}).toUpperCase()}</span><span class="text-sm font-bold">${d}.</span></div>
                    <div class="flex gap-1.5 justify-center">${['F','S','N','Sp','U','X'].map(t => `<button type="button" onclick="setShift('${key}','${t}')" class="btn-shift ${data.type===t?'active':''}">${t}</button>`).join('')}</div>
                    <div class="text-right"><input type="number" step="0.1" class="hr-edit" value="${data.hours}" onchange="updateHours('${key}', this.value)"></div>`;
                container.appendChild(row); 
                date.setDate(date.getDate() + 1);
            }
            saveAndCalc();
        }

        function setShift(k, t) { 
            userPlan[k] = { type: t, hours: shiftH[t] }; 
            localStorage.setItem('springer_v5', JSON.stringify(userPlan));
            renderCalendar(); 
        }

        function updateHours(k, v) { 
            if(!userPlan[k]) userPlan[k]={type:'X'}; 
            userPlan[k].hours = parseFloat(v)||0; 
            saveAndCalc(); 
        }

        function saveAndCalc() {
            ['tarif', 'sollstunden', 'h_ue', 'st_klasse', 'kinder', 'kirche'].forEach(id => {
                localStorage.setItem('p_'+id, document.getElementById(id).value);
            });
            localStorage.setItem('springer_v5', JSON.stringify(userPlan));
            
            const base = parseFloat(document.getElementById('tarif').value) || 0;
            const soll = parseFloat(document.getElementById('sollstunden').value) || 167;
            const stdLohn = base/soll;
            const stKl = parseInt(document.getElementById('st_klasse').value);
            const kiSt = parseFloat(document.getElementById('kirche').value);
            
            let ist=0, zSo=0, zSa=0, zN=0, zFt=0;
            const m=parseInt(document.getElementById('monthSelect').value);
            const y=parseInt(document.getElementById('yearSelect').value);
            const hols=getHolidays(y);

            for (let d=1; d<=31; d++) {
                const k = `${y}-${m}-${d}`; 
                const dt = new Date(y, m, d);
                if(dt.getMonth() !== m) continue;
                if (userPlan[k]) {
                    const e = userPlan[k];
                    const h = parseFloat(e.hours) || 0;
                    ist += h;
                    if (e.type !== 'X' && e.type !== 'U' && h > 0) {
                        if (hols[k]) zFt += h; 
                        else if (dt.getDay()===0) zSo += h; 
                        else if (dt.getDay()===6) zSa += h;
                        if (e.type==='N') zN += h;
                    }
                }
            }

            const zTotal = (zFt*stdLohn*1.35) + (zSo*stdLohn*0.5) + (zSa*stdLohn*0.25) + (zN*stdLohn*0.25);
            const ueBrutto = (parseFloat(document.getElementById('h_ue').value)||0)*stdLohn*1.25;
            const brutto = base + ueBrutto;
            let stSatz = 0.31; 
            if(stKl === 3) stSatz = 0.21; 
            if(stKl === 5 || stKl === 6) stSatz = 0.43;
            const netto = (brutto * (1 - (stSatz + (kiSt * 0.08)))) + zTotal;

            document.getElementById('planIst').innerText = ist.toFixed(1) + "h Gesamt";
            document.getElementById('statN').innerText = zN.toFixed(1) + "h";
            document.getElementById('statSo').innerText = zSo.toFixed(1) + "h";
            document.getElementById('statFt').innerText = zFt.toFixed(1) + "h";
            document.getElementById('finalNetto').innerText = netto.toLocaleString('de-DE',{minimumFractionDigits:2});
            document.getElementById('bruttoLabel').innerText = Math.round(brutto).toLocaleString('de-DE') + " ‚Ç¨";
            document.getElementById('taxFreeLabel').innerText = "+" + Math.round(zTotal).toLocaleString('de-DE') + " ‚Ç¨";
            
            const diff = ist - soll;
            const saldoEl = document.getElementById('planSaldo');
            saldoEl.innerText = (diff>=0?'+':'')+diff.toFixed(1)+"h";
            saldoEl.className = `text-xs font-black px-3 py-1 rounded-lg ${diff>=0?'bg-emerald-500/10 text-emerald-400':'bg-red-500/10 text-red-400'}`;
        }

        function shareWhatsApp() {
            const m = monthNames[document.getElementById('monthSelect').value], y = document.getElementById('yearSelect').value;
            const text = `üìä *LohnCheck Pro*\nüìÖ ${m} ${y}\n\n‚è± Ist: ${document.getElementById('planIst').innerText}\nüåô Nacht: ${document.getElementById('statN').innerText}\n‚òÄÔ∏è Sonntag: ${document.getElementById('statSo').innerText}\n\nüí∂ *Netto ca. ${document.getElementById('finalNetto').innerText} ‚Ç¨*`;
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`);
        }

        async function shareOrPrint() {
            const m = monthNames[document.getElementById('monthSelect').value];
            const y = document.getElementById('yearSelect').value;
            const netto = document.getElementById('finalNetto').innerText;

            if (navigator.share) {
                try {
                    await navigator.share({
                        title: `LohnCheck ${m} ${y}`,
                        text: `Lohnvorschau ${m} ${y}: ca. ${netto} ‚Ç¨ Netto.`,
                        url: window.location.href
                    });
                } catch (e) { window.print(); }
            } else {
                window.print();
            }
        }

        function resetAllShifts() {
            if(confirm("Alle Schichten im Kalender auf 'X' zur√ºcksetzen?")) {
                userPlan = {}; 
                localStorage.setItem('springer_v5', JSON.stringify(userPlan));
                renderCalendar(); 
            }
        }

        window.onload = init;
    </script>
</body>
</html>

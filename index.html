<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>LohnCheck Pro</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root { --bg: #0b0e14; --card: #1c2128; --accent: #6366f1; --text: #ffffff; --divider: rgba(255,255,255,0.06); }
        .light-mode { --bg: #f2f2f7; --card: #ffffff; --text: #000000; --divider: rgba(0,0,0,0.08); }
        
        body { background-color: var(--bg); color: var(--text); font-family: 'Plus Jakarta Sans', sans-serif; transition: 0.3s; padding-bottom: 60px; -webkit-tap-highlight-color: transparent; }
        
        .ios-blur { background: rgba(22, 27, 34, 0.8); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-bottom: 1px solid var(--divider); }
        
        .nav-btn { padding: 10px 20px; border-radius: 12px; font-size: 13px; font-weight: 600; transition: 0.2s; flex: 1; text-align: center; }
        .nav-btn.active { background: var(--accent); color: white; shadow: 0 4px 12px rgba(99, 102, 241, 0.3); }

        .card { background: var(--card); border-radius: 20px; border: 1px solid var(--divider); overflow: hidden; }
        
        /* Pr√§zises Kalender-Grid */
        .calendar-grid { display: grid; grid-template-columns: 60px 1fr 65px; align-items: center; border-bottom: 1px solid var(--divider); padding: 12px 16px; }
        .calendar-grid:last-child { border-bottom: none; }
        
        .btn-shift { width: 32px; height: 32px; border-radius: 8px; font-size: 11px; font-weight: 800; border: 1px solid var(--divider); background: rgba(255,255,255,0.03); color: var(--text); opacity: 0.4; transition: 0.2s; }
        .btn-shift.active { opacity: 1; background: var(--accent); border-color: var(--accent); color: white; transform: scale(1.05); }
        
        input.hr-edit { background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); width: 55px; height: 32px; border-radius: 8px; text-align: center; font-weight: bold; font-size: 13px; color: var(--text); outline: none; }
        
        .stat-card { background: linear-gradient(145deg, rgba(99,102,241,0.15), rgba(99,102,241,0.05)); border: 1px solid rgba(99,102,241,0.2); }
        
        select { border: none; background: transparent; color: var(--text); font-weight: 800; font-size: 1.25rem; outline: none; cursor: pointer; }
        .safe-area { padding-top: env(safe-area-inset-top); }
    </style>
</head>
<body class="safe-area">

    <nav class="ios-blur sticky top-0 z-50 p-4 mb-6">
        <div class="max-w-lg mx-auto flex items-center justify-between gap-4">
            <div class="flex flex-1 gap-1 bg-black/20 p-1 rounded-2xl border border-white/5">
                <button onclick="switchTab('plan')" id="btn-plan" class="nav-btn active">Plan</button>
                <button onclick="switchTab('rechner')" id="btn-rechner" class="nav-btn text-gray-400">Lohn</button>
                <button onclick="switchTab('profil')" id="btn-profil" class="nav-btn text-gray-400">Setup</button>
            </div>
            <button onclick="document.body.classList.toggle('light-mode')" class="w-10 h-10 flex items-center justify-center bg-white/5 rounded-2xl border border-white/10">üåì</button>
        </div>
    </nav>

    <main class="px-4 max-w-lg mx-auto">
        
        <div id="tab-plan" class="space-y-6">
            <div class="flex justify-between items-center px-1">
                <div>
                    <select id="monthSelect" onchange="renderCalendar()"></select>
                    <select id="yearSelect" onchange="renderCalendar()"></select>
                </div>
                <div id="planSaldo" class="text-sm font-bold px-3 py-1 rounded-full">-</div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="stat-card p-4 rounded-3xl text-center">
                    <p class="text-[10px] opacity-50 uppercase font-bold mb-1">Soll Stunden</p>
                    <p id="planSoll" class="text-xl font-black">-</p>
                </div>
                <div class="stat-card p-4 rounded-3xl text-center">
                    <p class="text-[10px] opacity-50 uppercase font-bold mb-1">Ist Stunden</p>
                    <p id="planIst" class="text-xl font-black text-indigo-400">-</p>
                </div>
            </div>

            <div class="card" id="calendarContainer"></div>
        </div>

        <div id="tab-rechner" class="hidden space-y-6">
            <div class="text-center py-8">
                <p class="text-xs opacity-40 uppercase font-bold tracking-widest mb-2">Gesch√§tztes Netto</p>
                <h1 id="finalNetto" class="text-7xl font-black tracking-tighter">0,00</h1>
            </div>
            
            <div class="card p-2">
                <div class="flex justify-between p-4 border-bottom border-white/5">
                    <span class="opacity-60 text-sm">Brutto (Basis + √úSt)</span>
                    <span id="bruttoLabel" class="font-bold">-</span>
                </div>
                <div class="flex justify-between p-4 bg-emerald-500/5">
                    <span class="opacity-60 text-sm">Steuerfreie Zuschl√§ge</span>
                    <span id="taxFreeLabel" class="font-bold text-emerald-400">-</span>
                </div>
            </div>

            <button onclick="shareWhatsApp()" class="w-full bg-[#25D366] text-black font-extrabold py-4 rounded-2xl flex items-center justify-center gap-2 shadow-lg active:scale-95 transition">
                <span>WhatsApp Export</span>
            </button>
        </div>

        <div id="tab-profil" class="hidden space-y-6">
            <div class="card p-2">
                <div class="p-4 flex justify-between items-center border-bottom border-white/5">
                    <span class="text-sm">Grundgehalt (‚Ç¨)</span>
                    <input type="number" id="tarif" value="4412" oninput="saveAndCalc()" class="hr-edit w-24">
                </div>
                <div class="p-4 flex justify-between items-center border-bottom border-white/5">
                    <span class="text-sm">Monats-Soll (h)</span>
                    <input type="number" id="sollstunden" value="167" oninput="saveAndCalc()" class="hr-edit w-24">
                </div>
                <div class="p-4 flex justify-between items-center">
                    <span class="text-sm">Auszahlung √ú-Std.</span>
                    <input type="number" id="h_ue" value="0" oninput="saveAndCalc()" class="hr-edit w-24">
                </div>
            </div>
            <p class="text-center text-[10px] opacity-30 px-6">Daten werden lokal in deinem Browser-Cache gespeichert.</p>
            <button onclick="localStorage.clear(); location.reload();" class="w-full py-4 text-red-500 text-xs font-bold uppercase tracking-widest opacity-50">App Daten l√∂schen</button>
        </div>

    </main>

    <script>
        const monthNames = ["Januar", "Februar", "M√§rz", "April", "Mai", "Juni", "Juli", "August", "September", "Oktober", "November", "Dezember"];
        const shiftData = { 'F': 7, 'S': 7, 'N': 10, 'Sp': 8, 'U': 8, 'X': 0 };
        let userPlan = JSON.parse(localStorage.getItem('springer_plan_v3')) || {};

        function getHolidays(year) {
            const h = {};
            const add = (d, m) => h[`${year}-${m}-${d}`] = true;
            add(1,0); add(1,4); add(3,9); add(31,9); add(25,11); add(26,11);
            const a = year%19, b = year%4, c = year%7, d = (19*a+24)%30, e = (2*b+4*c+6*d+5)%7;
            const ostern = new Date(year, 2, 22+d+e);
            const addR = (o) => { let x = new Date(ostern); x.setDate(ostern.getDate()+o); h[`${year}-${x.getMonth()}-${x.getDate()}`] = true; };
            [-2, 0, 1, 39, 49, 50, 60].forEach(addR);
            return h;
        }

        function init() {
            const ms = document.getElementById('monthSelect'), ys = document.getElementById('yearSelect'), now = new Date();
            monthNames.forEach((n,i) => ms.innerHTML += `<option value="${i}" ${i===now.getMonth()?'selected':''}>${n}</option>`);
            for(let i=now.getFullYear(); i<now.getFullYear()+20; i++) ys.innerHTML += `<option value="${i}">${i}</option>`;
            
            ['tarif', 'sollstunden', 'h_ue'].forEach(id => {
                const v = localStorage.getItem('profile_'+id);
                if(v) document.getElementById(id).value = v;
            });
            renderCalendar();
        }

        function switchTab(tab) {
            ['plan', 'rechner', 'profil'].forEach(t => {
                document.getElementById('tab-'+t).classList.toggle('hidden', t !== tab);
                document.getElementById('btn-'+t).classList.toggle('active', t === tab);
                document.getElementById('btn-'+t).classList.toggle('text-gray-400', t !== tab);
            });
        }

        function renderCalendar() {
            const m = parseInt(document.getElementById('monthSelect').value), y = parseInt(document.getElementById('yearSelect').value);
            const container = document.getElementById('calendarContainer');
            const holidays = getHolidays(y);
            container.innerHTML = '';
            
            let date = new Date(y, m, 1);
            while (date.getMonth() === m) {
                const d = date.getDate(), key = `${y}-${m}-${d}`, data = userPlan[key] || { type: 'X', hours: 0 };
                const isHoliday = holidays[key], isSun = date.getDay() === 0, isSat = date.getDay() === 6;

                const row = document.createElement('div');
                row.className = `calendar-grid ${isSun || isHoliday ? 'bg-red-500/5' : (isSat ? 'bg-indigo-500/5' : '')}`;
                row.innerHTML = `
                    <div class="flex flex-col">
                        <span class="text-[10px] font-black ${isHoliday||isSun?'text-red-400':(isSat?'text-indigo-400':'opacity-30')}">${date.toLocaleDateString('de-DE',{weekday:'short'}).toUpperCase()}</span>
                        <span class="text-sm font-bold">${d}.</span>
                    </div>
                    <div class="flex gap-1 justify-center">
                        ${['F','S','N','Sp','U','X'].map(t => `<button onclick="setShift('${key}','${t}')" class="btn-shift ${data.type===t?'active':''}">${t}</button>`).join('')}
                    </div>
                    <div class="text-right">
                        <input type="number" step="0.5" class="hr-edit" value="${data.hours}" onchange="updateHours('${key}', this.value)">
                    </div>
                `;
                container.appendChild(row);
                date.setDate(date.getDate() + 1);
            }
            saveAndCalc();
        }

        function setShift(k, t) { userPlan[k] = { type: t, hours: shiftData[t] }; saveAndCalc(); renderCalendar(); }
        function updateHours(k, v) { if(!userPlan[k]) userPlan[k]={type:'X'}; userPlan[k].hours = parseFloat(v)||0; saveAndCalc(); }

        function saveAndCalc() {
            localStorage.setItem('springer_plan_v3', JSON.stringify(userPlan));
            ['tarif', 'sollstunden', 'h_ue'].forEach(id => localStorage.setItem('profile_'+id, document.getElementById(id).value));
            
            const base = parseFloat(document.getElementById('tarif').value)||0, soll = parseFloat(document.getElementById('sollstunden').value)||167, stdLohn = base/soll;
            let ist = 0, zuschlag = 0, m = parseInt(document.getElementById('monthSelect').value), y = parseInt(document.getElementById('yearSelect').value), holidays = getHolidays(y);

            for (let d=1; d<=31; d++) {
                const key = `${y}-${m}-${d}`;
                if (userPlan[key]) {
                    const e = userPlan[key], hrs = e.hours, dt = new Date(y,m,d);
                    ist += hrs;
                    if (e.type !== 'X' && e.type !== 'U') {
                        if (holidays[key]) zuschlag += hrs * stdLohn * 1.35;
                        else if (dt.getDay()===0) zuschlag += hrs * stdLohn * 0.5;
                        else if (dt.getDay()===6) zuschlag += hrs * stdLohn * 0.25;
                        if (e.type==='N') zuschlag += hrs * stdLohn * 0.25;
                    }
                }
            }
            const diff = ist - soll;
            document.getElementById('planSoll').innerText = soll + "h";
            document.getElementById('planIst').innerText = ist.toFixed(1) + "h";
            document.getElementById('planSaldo').innerText = (diff >= 0 ? '+' : '') + diff.toFixed(1) + "h";
            document.getElementById('planSaldo').className = `text-sm font-bold px-3 py-1 rounded-full ${diff>=0?'bg-emerald-500/20 text-emerald-400':'bg-red-500/20 text-red-400'}`;
            
            const ue = (parseFloat(document.getElementById('h_ue').value)||0)*stdLohn*1.25;
            const netto = ((base + ue) * 0.65) + zuschlag;
            document.getElementById('finalNetto').innerText = netto.toLocaleString('de-DE',{minimumFractionDigits:2});
            document.getElementById('bruttoLabel').innerText = Math.round(base+ue).toLocaleString('de-DE') + " ‚Ç¨";
            document.getElementById('taxFreeLabel').innerText = Math.round(zuschlag).toLocaleString('de-DE') + " ‚Ç¨";
        }

        function shareWhatsApp() {
            const m = monthNames[document.getElementById('monthSelect').value], y = document.getElementById('yearSelect').value;
            const text = `üìä *LohnCheck Springer Pro*\nüìÖ Monat: ${m} ${y}\n\n‚è± Ist-Stunden: ${document.getElementById('planIst').innerText}\n‚öñÔ∏è Saldo: ${document.getElementById('planSaldo').innerText}\n\nüí∞ Brutto: ${document.getElementById('bruttoLabel').innerText}\n‚ú® Zuschl√§ge: ${document.getElementById('taxFreeLabel').innerText}\n\nüí∂ *Gesch√§tztes Netto: ${document.getElementById('finalNetto').innerText} ‚Ç¨*`;
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`);
        }
        window.onload = init;
    </script>
</body>
</html>
